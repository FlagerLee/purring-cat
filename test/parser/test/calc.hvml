<!DOCTYPE hvml>
<hvml>
    <head>
        <meta charset="UTF-8">
        <title>计算器</title>

        <style type="text/css">
            body{
                padding: 0;margin: 0;
                background-color:#4966c5 ;
            }
            #calculator{
                position: absolute;
                width: 1200px;height: 620px;
                left: 50%;top: 50%;
                margin-left: -600px;
                margin-top: -310px;
            }
            #calculator #c_title {
                margin: auto;
                /*margin-left: 300px;*/
                width: 800px;
                height: 80px;
            }
            #calculator #c_title h2{
                text-align: center;
                font-size: 33px;font-family: "微软雅黑";color: #666;
                line-height: 30px;
            }
            #c_text{
                width: 1000px;
                margin: auto;
            }
            #calculator #c_text #text{
                /*margin-left: 200px;*/
                padding-right: 10px;
                width: 1000px;
                height: 50px;
                font-size: 25px;font-family: "微软雅黑";color: #666666;
                text-align: right;border: 1px white;
                border: double 1px;
            }
            #calculator #c_value{
                width: 1080px;height: 408px;
                /*margin-left: 160px;*/
                margin: 20px auto;
            }
            #calculator #c_value ul{
                margin: 0;
            }
            #calculator #c_value ul li{
                margin: 10px;
                list-style: none;float: left;
                width: 180px;height: 80px;line-height: 80px;
                text-align: center;background-color: chartreuse;
                border: 1px solid black;
                font-size: 30px;font-family: "微软雅黑";color: #666;
                box-shadow: 5px 5px 30px rgba(0,0,0,0.4);           
                -webkit-user-select: none;
                -ms-user-select: none;
                -moz-user-select: none;
            }
            #calculator #c_value ul li:active{
                background-color: white;
            }
            #calculator #c_value ul li:hover{
                opacity:0.8;
                cursor:pointer;
            }
            #calculator #c_value ul .c_blue{
                background-color: cornflowerblue;color: #000000;
            }
            #calculator #c_value ul .c_yellow{
                background-color: #f9f900;color: #000000;
            }
        </style>
    </head>

    <body>
        <div id="calculator">
            <div id="c_title"><h2>计算器</h2></div>
            <div id="c_text">
                <input type="text" id="text" value="0" readonly="readonly" />
            </div>
            <div id="c_value">
                <ul id="button_panel">
                    <li id="btn_7">7</li>
                    <li id="btn_8">8</li>
                    <li id="btn_9">9</li>
                    <li id="btn_BackSpace" class="c_blue">←</li>
                    <li id="btn_clear" class="c_blue">C</li>
                    <li id="btn_4">4</li>
                    <li id="btn_5">5</li>
                    <li id="btn_6">6</li>
                    <li id="btn_mul" class="c_blue">×</li>
                    <li id="btn_div" class="c_blue">÷</li>
                    <li id="btn_1">1</li>
                    <li id="btn_2">2</li>
                    <li id="btn_3">3</li>
                    <li id="btn_add" class="c_blue">+</li>
                    <li id="btn_sub" class="c_blue">-</li>
                    <li id="btn_0">0</li>
                    <li id="btn_00">00</li>
                    <li id="btn_dot">.</li>
                    <li id="btn_mod" class="c_blue">%</li>
                    <li id="btn_eq" class="c_yellow">=</li>
                </ul>
            </div>
        </div>
    </body>

    <init as="params">
        [
            { "c_text" : "0" },  //计算器液晶屏上显示的字符串内容
            { "l_value" : "" },  //左值，以字符串形式暂存
            { "r_value" : "" },  //右值，以字符串形式暂存
            { "operator" : "" }  //当前操作符，选项有+-*/%，""表示未设置
        ]
    </init>

    <!-- btn_clear 的操作逻辑如下： -->
    <!-- 把 params 复原成 init 时的样子 -->

    <!-- btn_0 到 btn_9 的操作逻辑如下： -->
    <!-- 判断 c_text 的值，如果是 "Error" 则先调用 btn_clear -->
    <!-- 判断 operator 变量，如果是 "" 则在 l_value 的末尾添加字符，否则在 r_value 的末尾添加字符 -->
    <!-- l_value 或 r_value 首字符只允许插入 1 个 0，如果其值为 "0" 则先删除此 0 再在末尾添加字符 -->
    <!-- 执行有效的插入操作之后，在 c_text 末尾添加相应的符号 -->

    <!-- btn_dot 的操作逻辑如下： -->
    <!-- 判断 c_text 的值，如果是 "Error" 则先调用 btn_clear -->
    <!-- 判断 operator 变量，如果是 "" 则在 l_value 的末尾添加字符，否则在 r_value 的末尾添加字符 -->
    <!-- l_value 或 r_value 如果是空字符串，则添加 "0." -->
    <!-- l_value 或 r_value 末尾如果有一个 "." 则不添加符号 -->

    <!-- btn_BackSpace 的操作逻辑如下： -->
    <!-- 判断 c_text 的值，如果是 "Error" 则先调用 btn_clear，结束。 -->
    <!-- 判断 operator 变量，如果是 "" 则在 l_value 的末尾删除字符，否则在 r_value 的末尾删除字符 -->
    <!-- 选择在 r_value 末尾删除字符时，如果 r_value 已经被删空，则将 operator 设置为 "" -->

    <!-- btn_eq的操作逻辑如下： -->
    <!-- 判断 c_text 的值，如果是 "Error" 则无操作，结束。 -->
    <!-- 直接根据 l_value \ r_value \ operator 算出结果，同时覆盖 c_text 和 l_value 的值 -->
    <!-- 清空 r_value 和 operator -->
    <!-- 如果计算出错，则清空 l_value \ r_value \ operator，将 c_text 设置为 "Error" -->

    <!-- btn_add \ btn_sub \ btn_mul \ btn_div \ btn_mod的操作逻辑如下： -->
    <!-- 判断 c_text 的值，如果是 "Error" 则先调用 btn_clear -->
    <!-- 首先检查 operator 的值，如果为空，再检查 l_value 的值，如果也是空，则无操作，结束。 -->
    <!-- 如果 operator 已有操作符，再检查 r_value 的值， -->
    <!-- 如果 r_value 的值为空，则修改 operator 的值，再修改 c_text 的尾字符，结束 -->
    <!-- 如果 r_value 的值不为空，则调用 btn_eq 的操作，（如果计算正确，算式的结果将存放于 l_value 中） -->
    <!-- 检查 l_value 的值，如果有值，则修改 operator 的值，结束。 -->
    <!-- 其它情况，结束。 -->

    <observe on="$btn_0" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_00" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_1" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_2" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_3" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_4" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_5" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_6" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_7" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_8" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_9" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_dot" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_clear" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_BackSpace" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_add" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_sub" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_mul" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_div" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

    <observe on="$btn_mod" for="click">
        <update on="$fileInfo" key.selected_type=$?.type key.selected_name=$?.name />
    </observe>

</hvml>